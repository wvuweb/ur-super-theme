<div class="so-featurettes so-featurettes--1 <r:page:content name="so-background-color-class--featurettes" /> background">
  <div class="so-featurettes__container">

    <r:page:if_has_content_for region="so-featurettes__header" always_show_in_edit_mode="true">
      <div class="so-featurettes__header">
        <r:editable_region name="so-featurettes__header">
          <h2>Featurettes Headline</h2>
          <p>Subhead goes here.</p>
        </r:editable_region>
      </div>
    </r:page:if_has_content_for>

    <r:set_var name="featurettes_id">
      <r:page:data name="featurettes_id" />
    </r:set_var>

    <r:get_page id="{$featurettes_id}">

      <r:children by="name" order="asc" labels="feature" labels_match="any">
        <div class="so-featurettes__featurettes so-featurettes__featurettes--<r:count />">
          <r:each>
            <div class="so-featurettes__featurette">
              <r:set_var name="soFeaturettesInfoWide" default="nophoto" />
              <r:page:if_has_content_for region="so-page-meta__thumb">
                <div class="so-featurettes__photo">
                  <a href="<r:page:unless_has_content_for region="so-featurettes__url"><r:page:url /></r:page:unless_has_content_for><r:page:if_has_content_for region="so-featurettes__url"><r:page:content name="so-featurettes__url" /></r:page:if_has_content_for>"><r:page:content name="so-page-meta__thumb" /></a>
                </div>
                <r:set_var name="soFeaturettesInfoWide">
                  hasphoto
                </r:set_var>
              </r:page:if_has_content_for>
              <div class="so-featurettes__info so-featurettes__info--<r:var name="soFeaturettesInfoWide" />">
                <h3><a href="<r:page:unless_has_content_for region="so-featurettes__url"><r:page:url /></r:page:unless_has_content_for><r:page:if_has_content_for region="so-featurettes__url"><r:page:content name="so-featurettes__url" /></r:page:if_has_content_for>"><r:page:first_non_blank_attr names="alternate_name,name" /></a></h3>
                <r:if_has_content_for region="so-page-desc">
                  <p>
                    <r:page:content name="so-page-desc" />
                  </p>
                </r:if>
                <r:if_has_content_for region="so-page-extras">
                  <r:page:content name="so-page-extras" />
                </r:if_has_content_for>
                <p>
                  <a class="button" href="<r:page:unless_has_content_for region="so-featurettes__url"><r:page:url /></r:page:unless_has_content_for><r:page:if_has_content_for region="so-featurettes__url"><r:page:content name="so-featurettes__url" /></r:page:if_has_content_for>"><r:page:unless_has_content_for region="so-featurettes__link-text">More About <r:page:name /></r:page:unless_has_content_for><r:page:if_has_content_for region="so-featurettes__link-text"><r:page:content name="so-featurettes__link-text" /></r:page:if_has_content_for></a>
                </p>
              </div>
            </div>
          </r:each>
        </div>
      </r:children>

    </r:get_page>

  </div>
</div>

<r:edit_mode_only>
  <div class="so-instructions">
    <strong>Instructions for Featurettes:</strong> This loops through the children of page and pulls content to create sub-features. Enter the parent page&rsquo;s ID in the <strong>featurettes_id</strong> field in the site properties. Each page you wish featured must be labelled "feature".
    <p><strong>Background Color:</strong> <r:editable_region name="so-background-color-class--featurettes" /></p>
  </div>
</r:edit_mode_only>
